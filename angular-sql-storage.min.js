!function(){"use strict";function e(){function e(e){a[e.version]=e.method}function t(e,t){function n(t,a){var n;return i._database=t,n=Object.keys(i._updateMethods).reduce(function(e,t){return t=parseFloat(t),t>a&&e.push(r(t)),e},[]),e.all(n)}function r(e){return t.invoke(i._updateMethods[e],i)}var i={};return i._database=null,i._updateMethods=a,i.updateManager=n,i}var a={};this.addUpdater=e,this.$get=t,t.$inject=["$q","$injector"]}function t(e){function t(e){o=e.name,s=e.version}function a(e){u=e}function n(e){c=e}function r(t){e.addUpdater(t)}function i(e,t,a,n,r,i){function l(){return p=c?n.invoke(c):t.openDatabase(o,"1.0","database",2e5)}function d(){return p?p:this.initDatabase()}function f(){var t,n,o=this,c=(u.defaultFields||[]).map(v),l=this.tables;return this.createPromise?this.createPromise:(t=this.getDatabase(),n=Object.keys(l).map(function(e){var t=h(l[e],c);return o.execute(t)}),this.createPromise=e.all(n).then(function(){var e=r.get("database_version")||0;return a.debug("[Storage] Create DB SUCCESS"),e&&s>e?i.updateManager(t,e).then(function(){return r.set("database_version",s),t}):t}),this.createPromise)}function b(){var t=this,n=Object.keys(this.tables).map(function(e){return t.tables[e].table_name}),i=n.map(function(e){var a="DROP TABLE IF EXISTS "+e;return t.execute(a)});return r.clearAll(),e.all(i).then(function(e){return t.createPromise=null,a.debug("[Storage] Drop DB SUCCESS"),e})}function g(t,a){var n=e.defer(),r=this.getDatabase();return r.transaction(function(e){e.executeSql(t,a,function(e,t){n.resolve(t)},function(e,t){n.reject(t)})}),n.promise}function h(e,t){var a=e.indexed_fields||[],n=t.concat(a.map(v));return["CREATE TABLE IF NOT EXISTS",e.table_name,"("+n.join(", ")+")"].join(" ")}function v(e){var t=[e.name,e.type];return e.unique&&t.push("UNIQUE"),e.primayKey&&t.push("PRIMARY KEY"),t.join(" ")}var S={},p=null;return u||(a.error("Please set a database configuration"),u={}),S.createPromise=null,S.tables=u.tables||{},S.initDatabase=l,S.getDatabase=d,S.initTables=f,S.deleteDatas=b,S.execute=g,S}var o="database.db",s=1,u=null,c=null;this.$get=i,this.setDatabaseConfig=t,this.setDatabaseSchema=a,this.setDatabaseInstance=n,this.addUpdater=r,i.$inject=["$q","$window","$log","$injector","localStorageService","sqlStorageMigrationService"]}angular.module("sf.sqlStorage",["LocalStorageModule"]),angular.module("sf.sqlStorage").provider("sqlStorageMigrationService",e),angular.module("sf.sqlStorage").provider("sqlStorageService",t),t.$inject=["sqlStorageMigrationServiceProvider"]}();