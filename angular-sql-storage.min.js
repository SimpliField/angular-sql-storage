!function(){"use strict";function e(){function e(e){a[e.version]=e.method}function t(e,t){function n(t,a){var n;return i._database=t,n=Object.keys(i._updateMethods).reduce(function(e,t){return t=parseFloat(t),t>a&&e.push(r(t)),e},[]),e.all(n)}function r(e){return t.invoke(i._updateMethods[e],i)}var i={};return i._database=null,i._updateMethods=a,i.updateManager=n,i}t.$inject=["$q","$injector"];var a={};this.addUpdater=e,this.$get=t}angular.module("sf.sqlStorage",["LocalStorageModule"]),angular.module("sf.sqlStorage").provider("sqlStorageMigrationService",e),function(){function e(e){function a(e){s=e.name,u=e.version}function n(e){c=e}function r(e){l=e}function i(t){e.addUpdater(t)}function o(e,a,n,r,i,o){function d(){return D=l?r.invoke(l):a.openDatabase(s,"1.0","database",2e5)}function f(){return D?D:this.initDatabase()}function b(){function e(){function e(){return i.set(t,u),r}var r=a.getDatabase(),s=i.get(t)||0;return n.debug("[Storage] Create DB SUCCESS"),s&&s<u?o.updateManager(r,s).then(e):e()}var a=this,r=this.tables;return this.createPromise?this.createPromise:(this.createPromise=this.createTables(c.defaultFields,r).then(e),this.createPromise)}function g(t,a){var n=this,r=(t||[]).map(p),i=Object.keys(a).map(function(e){var t=S(a[e],r);return n.execute(t)});return e.all(i)}function h(){var t=this,a=Object.keys(this.tables).map(function(e){return t.tables[e].table_name}),r=a.map(function(e){var a="DROP TABLE IF EXISTS "+e;return t.execute(a)});return i.clearAll(),e.all(r).then(function(e){return t.createPromise=null,n.debug("[Storage] Drop DB SUCCESS"),e})}function v(t,a){var n=e.defer(),r=this.getDatabase();return r.transaction(function(e){e.executeSql(t,a,function(e,t){n.resolve(t)},function(e,t){n.reject(t)})}),n.promise}function S(e,t){var a=e.indexed_fields||[],n=t.concat(a.map(p));return["CREATE TABLE IF NOT EXISTS",e.table_name,"("+n.join(", ")+")"].join(" ")}function p(e){var t=[e.name,e.type];return e.unique&&t.push("UNIQUE"),e.primayKey&&t.push("PRIMARY KEY"),t.join(" ")}var m={},D=null;return c||(n.error("Please set a database configuration"),c={}),m.createPromise=null,m.tables=c.tables||{},m.initDatabase=d,m.getDatabase=f,m.initTables=b,m.deleteDatas=h,m.createTables=g,m.execute=v,m}o.$inject=["$q","$window","$log","$injector","localStorageService","sqlStorageMigrationService"];var s="database.db",u=1,c=null,l=null;this.$get=o,this.setDatabaseConfig=a,this.setDatabaseSchema=n,this.setDatabaseInstance=r,this.addUpdater=i}e.$inject=["sqlStorageMigrationServiceProvider"];var t="database_version";angular.module("sf.sqlStorage").provider("sqlStorageService",e)}()}();